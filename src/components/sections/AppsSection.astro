---
interface Props {
  apps: Array<{ name: string; icon: string }>;
}

const { apps } = Astro.props;

// Map icon keys to Simple Icons CDN URLs or custom SVGs
const getIconUrl = (icon: string): string | null => {
  const iconMap: Record<string, string> = {
    notion: 'https://cdn.simpleicons.org/notion/000000',
    slack: 'https://cdn.simpleicons.org/slack',
    vscode: 'https://cdn.simpleicons.org/visualstudiocode/007ACC',
    discord: 'https://cdn.simpleicons.org/discord/5865F2',
    obsidian: 'https://cdn.simpleicons.org/obsidian/7C3AED',
    linear: 'https://cdn.simpleicons.org/linear/5E6AD2',
    github: 'https://cdn.simpleicons.org/github/181717',
    figma: 'https://cdn.simpleicons.org/figma',
    word: 'https://cdn.simpleicons.org/microsoftword/2B579A',
    chrome: 'https://cdn.simpleicons.org/googlechrome',
    safari: 'https://cdn.simpleicons.org/safari/006CFF',
    gdocs: 'https://cdn.simpleicons.org/googledocs/4285F4',
  };
  return iconMap[icon] || null;
};

// Apple/macOS app icons as inline SVGs
const appleIcons: Record<string, string> = {
  notes: `<svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="120" height="120" rx="26" fill="#FFCC02"/>
    <rect x="24" y="30" width="72" height="60" rx="4" fill="white"/>
    <rect x="32" y="42" width="40" height="4" rx="2" fill="#E5E5E5"/>
    <rect x="32" y="52" width="56" height="4" rx="2" fill="#E5E5E5"/>
    <rect x="32" y="62" width="48" height="4" rx="2" fill="#E5E5E5"/>
    <rect x="32" y="72" width="52" height="4" rx="2" fill="#E5E5E5"/>
  </svg>`,
  mail: `<svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="120" height="120" rx="26" fill="#1E90FF"/>
    <path d="M24 42L60 68L96 42" stroke="white" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
    <rect x="24" y="36" width="72" height="48" rx="4" stroke="white" stroke-width="5" fill="none"/>
  </svg>`,
  xcode: `<svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="120" height="120" rx="26" fill="#147EFB"/>
    <path d="M40 40L60 60L80 40" stroke="white" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M40 80L60 60L80 80" stroke="white" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="60" cy="60" r="8" fill="white"/>
  </svg>`,
  things: `<svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="120" height="120" rx="26" fill="#4A90D9"/>
    <circle cx="60" cy="60" r="28" stroke="white" stroke-width="6" fill="none"/>
    <path d="M48 60L56 68L72 52" stroke="white" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`,
  messages: `<svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="120" height="120" rx="26" fill="#34C759"/>
    <path d="M30 58C30 44 44 34 60 34C76 34 90 44 90 58C90 72 76 82 60 82C56 82 52 81.5 48.5 80.5L34 88L38 74C33 69 30 64 30 58Z" fill="white"/>
  </svg>`,
  terminal: `<svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="120" height="120" rx="26" fill="#1D1D1F"/>
    <path d="M36 48L52 60L36 72" stroke="#34C759" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M56 72H84" stroke="#34C759" stroke-width="6" stroke-linecap="round"/>
  </svg>`,
};

// Duplicate apps for seamless infinite scroll
const duplicatedApps = [...apps, ...apps];
---

<!-- App Compatibility Section -->
<section class="apps-section" id="apps" data-fade-in>
 <div class="container">
    <h2 class="section-title text-center">Dictate Directly into Any App.</h2>
    <p class="section-subtitle text-center">
      Mellon lives in your menu bar and works in every text field on your Mac. 
      <strong>Just one click, zero copy-pasting required.</strong>
    </p>
  </div>
  
  <div class="carousel-container">
    <div class="carousel-track">
      {duplicatedApps.map((app) => {
        const iconUrl = getIconUrl(app.icon);
        const appleIcon = appleIcons[app.icon];
        
        return (
          <div class="app-card">
            <div class="app-icon-wrapper">
              {appleIcon ? (
                <div class="app-icon-svg" set:html={appleIcon} />
              ) : iconUrl ? (
                <img src={iconUrl} alt={app.name} class="app-icon-img" loading="lazy" />
              ) : (
                <div class="app-icon-fallback">
                  <span>{app.name.substring(0, 1)}</span>
                </div>
              )}
            </div>
            <span class="app-name">{app.name}</span>
          </div>
        );
      })}
    </div>
  </div>
  
  <div class="container">
  <p class="hero-note text-center" style="margin-top: 2rem; opacity: 0.8;">
    Perfect for Developers, Medical Professionals, Notes, Writers, Email Power Users.
  </p>
  </div>
</section>

<style>
  /* ========== APP COMPATIBILITY SECTION ========== */
  .apps-section {
    background-color: var(--color-bg-primary);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    overflow: hidden;
  }

  .carousel-container {
    position: relative;
    width: 100%;
    margin: var(--space-3xl) 0;
    mask-image: linear-gradient(
      to right,
      transparent,
      black 5%,
      black 95%,
      transparent
    );
    -webkit-mask-image: linear-gradient(
      to right,
      transparent,
      black 5%,
      black 95%,
      transparent
    );
  }

  .carousel-track {
    display: flex;
    gap: var(--space-lg);
    animation: scroll 40s linear infinite;
    width: max-content;
  }

  .carousel-track:hover {
    animation-play-state: paused;
  }

  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }

  .app-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-lg);
    background: var(--color-bg-secondary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    min-width: 120px;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    cursor: pointer;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2), 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .app-card:hover {
    transform: translateY(-8px) scale(1.03);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2);
    border-color: rgba(255, 255, 255, 0.2);
  }

  .app-card:hover .app-name {
    color: var(--color-text-primary);
  }

  .app-icon-wrapper {
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .app-icon-svg {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    overflow: hidden;
  }

  .app-icon-svg :global(svg) {
    width: 100%;
    height: 100%;
  }

  .app-icon-img {
    width: 48px;
    height: 48px;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
  }

  .app-icon-fallback {
    width: 56px;
    height: 56px;
    border-radius: 12px;
    background: var(--color-bg-tertiary);
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .app-icon-fallback span {
    font-size: 24px;
    font-weight: 700;
    color: var(--color-text-muted);
  }

  .app-name {
    font-size: 13px;
    color: var(--color-text-secondary);
    font-weight: 500;
    text-align: center;
    white-space: nowrap;
    transition: color var(--transition-normal);
  }

  .apps-note {
    margin-top: var(--space-lg);
    font-size: 14px;
  }

  /* ========== RESPONSIVE ========== */
  @media (max-width: 768px) {
    .carousel-track {
      gap: var(--space-md);
      animation-duration: 30s;
    }

    .app-card {
      min-width: 100px;
      padding: var(--space-md);
    }

    .app-icon-wrapper,
    .app-icon-svg,
    .app-icon-fallback {
      width: 48px;
      height: 48px;
    }

    .app-icon-img {
      width: 40px;
      height: 40px;
    }

    .app-name {
      font-size: 12px;
    }
  }

  @media (max-width: 480px) {
    .carousel-track {
      animation-duration: 25s;
    }

    .app-card {
      min-width: 90px;
    }
  }
</style>
